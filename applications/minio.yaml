apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: minio
  namespace: devops
spec:
  project: default
  source:
    repoURL: registry-1.docker.io
    targetRevision: 14.8.0
    chart: bitnamicharts/minio
    helm:
      values: |
        fullnameOverride: minio

        auth:
          useSecret: true
          existingSecret: minio-credentials
          rootUserSecretKey: username
          rootPasswordSecretKey: password

        nodeSelector:
          kubernetes.io/hostname: alteret.object-storage.ubnt.local

        tolerations:
        - key: object-storage
          operator: Exists
          effect: NoSchedule

        ingress:
          enabled: true
          hostname: object-storage.priv

        apiIngress:
          enabled: true
          hostname: object-storage-api.priv

        persistence:
          existingClaim: minio-data

        serviceMonitor:
          enabled: true
          interval: 300s

  destination:
    server: https://kubernetes.default.svc
    namespace: object-storage
  syncPolicy:  
    automated:
      prune: true
      selfHeal: true
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: minio-data
  namespace: object-storage
spec:
  capacity:
    storage: 1800Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: /mnt/data
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: minio-data
  namespace: object-storage
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1800Gi